/*!
 * FilePondPluginImageEdit 1.2.0
 * Licensed under MIT, https://opensource.org/licenses/MIT/
 * Please visit https://pqina.nl/filepond/ for details.
 */

/* eslint-disable */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).FilePondPluginImageEdit=t()}(this,function(){"use strict";var e=function(e){return/^image/.test(e.type)},t=function(t){var i=t.addFilter,n=t.utils,o=t.views,r=n.Type,a=n.createRoute,E=n.createItemAPI,d=void 0===E?function(e){return e}:E,l=o.fileActionButton;i("SHOULD_REMOVE_ON_REVERT",function(t,i){var n=i.item,o=i.query;return new Promise(function(t){var i=n.file;t(!(o("GET_ALLOW_IMAGE_PREVIEW")&&o("GET_ALLOW_IMAGE_EDIT")&&o("GET_IMAGE_EDIT_ALLOW_EDIT")&&e(i)))})}),i("DID_LOAD_ITEM",function(t,i){var n=i.query,o=i.dispatch;return new Promise(function(i,r){if(t.origin>1)i(t);else{var a=t.file;if(n("GET_ALLOW_IMAGE_PREVIEW")&&n("GET_ALLOW_IMAGE_EDIT")&&n("GET_IMAGE_EDIT_INSTANT_EDIT"))if(e(a)){var E=function(e,t,i){return function(n){c.shift(),n?t(e):i(e),o("KICK"),d()}},d=function(){if(c.length){var e=c[0],t=e.item,i=e.resolve,n=e.reject;o("EDIT_ITEM",{id:t.id,handleEditorResponse:E(t,i,n)})}};f({item:t,resolve:i,reject:r}),1===c.length&&d()}else i(t);else i(t)}})}),i("DID_CREATE_ITEM",function(e,t){t.query;var i=t.dispatch;e.extend("edit",function(){i("EDIT_ITEM",{id:e.id})})});var c=[],f=function(e){return c.push(e),e};return i("CREATE_VIEW",function(t){var i=t.is,n=t.view,o=t.query;if(i("file")&&o("GET_ALLOW_IMAGE_PREVIEW")&&o("GET_ALLOW_IMAGE_EDIT")){var r=o("GET_IMAGE_EDIT_EDITOR");if(r){r.outputData=!0,r.outputFile=!1,r.cropAspectRatio=o("GET_IMAGE_CROP_ASPECT_RATIO")||r.cropAspectRatio,r.filepondCallbackBridge||(r.filepondCallbackBridge={onconfirm:r.onconfirm||function(){},oncancel:r.oncancel||function(){}});n.registerDestroyer(function(e){var t=e.root;t.ref.buttonEditItem&&t.ref.buttonEditItem.off("click",t.ref.handleEdit)}),n.registerWriter(a({DID_IMAGE_PREVIEW_SHOW:function(e){var t=e.root;t.ref.buttonEditItem&&(t.ref.buttonEditItem.opacity=1)},DID_LOAD_ITEM:function(t){var i=t.root,r=t.props;if(o("GET_IMAGE_EDIT_ALLOW_EDIT")){var a=r.id,E=o("GET_ITEM",a);if(E){var d=E.file;if(e(d)){var c=n.createChildView(l,{label:"edit",icon:o("GET_IMAGE_EDIT_ICON_EDIT"),opacity:0});c.element.classList.add("filepond--action-edit-item"),c.element.dataset.align=o("GET_STYLE_IMAGE_EDIT_BUTTON_EDIT_ITEM_POSITION"),i.ref.handleEdit=function(e){e.stopPropagation(),i.dispatch("EDIT_ITEM",{id:a})},c.on("click",i.ref.handleEdit),i.ref.buttonEditItem=n.appendChildView(c)}}}},EDIT_ITEM:function(e){var t=e.root,i=e.props,n=e.action,o=i.id,a=n.handleEditorResponse,E=t.query("GET_ITEM",o);if(E){var l=E.file,c=E.getMetadata("crop"),f=E.getMetadata("resize"),u={crop:c||{center:{x:.5,y:.5},flip:{horizontal:!1,vertical:!1},zoom:1,rotation:0,aspectRatio:null},size:f?{upscale:f.upscale,mode:f.mode,width:f.size.width,height:f.size.height}:null};r.onconfirm=function(e){var t=e.data,i=t.crop,n=t.size,o={};if(i&&(o.crop=i),n){var l=(E.getMetadata("resize")||{}).size,c={width:n.width,height:n.height};c.width&&c.height||!l||(c.width=l.width,c.height=l.height),(c.width||c.height)&&(o.resize={upscale:n.upscale,mode:n.mode,size:c})}E.setMetadata(o),r.filepondCallbackBridge.onconfirm(t,d(E)),a&&(r.onclose=function(){a(!0),r.onclose=null})},r.oncancel=function(){r.filepondCallbackBridge.oncancel(d(E)),a&&(r.onclose=function(){a(!1),r.onclose=null})},r.open(l,u)}}}))}}}),{options:{allowImageEdit:[!0,r.BOOLEAN],styleImageEditButtonEditItemPosition:["bottom center",r.STRING],imageEditInstantEdit:[!1,r.BOOLEAN],imageEditAllowEdit:[!0,r.BOOLEAN],imageEditIconEdit:['<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg"><path d="M8.5 17h1.586l7-7L15.5 8.414l-7 7V17zm-1.707-2.707l8-8a1 1 0 0 1 1.414 0l3 3a1 1 0 0 1 0 1.414l-8 8A1 1 0 0 1 10.5 19h-3a1 1 0 0 1-1-1v-3a1 1 0 0 1 .293-.707z" fill="currentColor" fill-rule="nonzero"/></svg>',r.STRING],imageEditEditor:[null,r.OBJECT]}}};return"undefined"!=typeof window&&void 0!==window.document&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:t})),t});
